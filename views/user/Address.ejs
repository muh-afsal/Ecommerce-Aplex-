<%-include("./partials/header.ejs")%>

    <style>
        .cart-total-container {
            height: auto;
            width: 22vw;
            float: right;
            margin-top: -95vh;
            margin-right: 94px;
            border-radius: 13px;
            box-shadow: rgba(0, 0, 0, 0.1) 0px -4px 16px 0px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px;
            font-size: small;
        }


        .coupon-input {
            height: 9vh;
            box-shadow: rgba(0, 0, 0, 0.1) 0px -4px 16px 0px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px;
            border-radius: 13px;
            margin-top: -217px;

            width: 281px;
            float: right;
            margin-right: 154PX;

        }


        .cart-products-listing {
            height: auto;
            /* width: 30vw; */
            border-radius: 12px;
            box-shadow: rgba(0, 0, 0, 0.1) 0px -4px 16px 0px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px;
            padding-bottom: 88px;
            overflow: scroll;
        }

        .cart-products-listing::-webkit-scrollbar {
            width: 0;
            /* Remove scrollbar space on Webkit browsers */
        }

        .cart-products-listing {
            scrollbar-width: none;
            /* Firefox */
        }

        .cart-products-container {
            height: auto;
            width: 80%;
            margin-top: 50px;
            padding-bottom: 10vh;
            margin-left: 179px;
        }


        .cart-container {
            height: auto;
        }

        @media(max-width:1200px) {
            .cart-total-container {
                margin-top: 27px;
                float: left;
                width: 70vw;
                margin-left: 30px;
            }

            .cart-products-container {
                width: 90%;
            }
        }

        .search-nav {
            width: 100%;
            height: 60px;
        }

        @media(max-width:850px) {
            #coupon-code-div {
                display: none;
            }

            .search-bars {
                justify-content: center;
            }
        }

        @media(max-width:500px) {
            .cart-products-container {
                margin-left: 18px;
            }

            th {
                font-size: smaller;
            }
        }

        .total-values {
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .total-values-container {
            display: grid;
            margin-top: 31px;
            margin-left: 20px;
            margin-right: 20px;
        }

        .total-texts {
            font-weight: 600;
            color: rgba(85, 85, 85, 0.682)
        }

        .cart-prices {
            margin-right: 20px;
        }

        .btn {
            border-radius: 50px;
            text-align: center;
            padding: 0.45rem 0.8rem;
            outline: 0;
            color: white;
            background-color: #4461F2;
            box-shadow: 0px 0px 5px -1px #4461F2;
            width: 13vw;
            height: 36px;
            margin-top: 1px;
            margin-left: 74px;
            margin-bottom: 16px;
        }

        @media (max-width:1200px) {
            .btn {
                width: 27vw;
                margin-left: 270px;
            }
        }

        @media (max-width:900px) {
            .btn {
                width: 27vw;
                margin-left: 200px;
            }
        }

        @media (max-width:700px) {
            .btn {
                width: 42vw;
                margin-left: 97px;
            }
        }

        @media (max-width:500px) {
            .btn {
                width: 48vw;
                margin-left: 52px;
            }
        }

        @media (max-width:380px) {
            .btn {
                width: 49vw;
                margin-left: 32px;
            }
        }

        .btn:hover {
            background-color: #304ee4;
            color: aliceblue;
        }

        .value-button {
            display: inline-block;
            margin: 0px;
            width: 32px;
            height: 36px;
            text-align: center;
            vertical-align: middle;
            padding: 6px 0;
            background: #eee;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .value-button:hover {
            cursor: pointer;
        }

        form .decrease {
            margin-right: -4px;
            border-radius: 22px 0 0 22px;
        }

        form .increase {
            margin-left: -4px;
            border-radius: 0 22px 22px 0;
        }

        form #input-wrap {
            margin: 0px;
            padding: 0px;
        }

        input.number {
            text-align: center;
            border: none;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            margin: 0px;
            width: 40px;
            height: 35px;
        }


        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .confirm-button {
            width: 119px;
            text-align: center;
            height: 32px;
            background-color: #4461F2;
            border-radius: 7px;
            padding-top: 4px;
            text-decoration: none;
            color: #ddd;
        }

        .preview-products {
            height: auto;
            width: 100%;
            border-radius: 10px;
            padding-top: 10px;
            border: .5px solid;
        }

        .display_product {
            height: 62px;
            margin-top: -10px;
            border-top: 0.5px solid;
        }

        .preview-products {
            overflow: hidden;

        }

        .display_product {
            margin-bottom: 10px;
        }

        .preview-products::-webkit-scrollbar {
            width: 0;

        }

        .preview-products {
            scrollbar-width: none;
            /* Firefox */
        }

        .selectPayment {

            width: 14vw;
            float: right;
            border-radius: 13px;
            padding: 16px;

            float: left;

        }

        .selectAddresscontainer {
            height: 68vh;
            /* background: aquamarine; */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 44px;
        }

        .selectAddress {
            cursor: pointer;
            width: 21vw;
            background-color: #eff6ff;
            height: 31vh;
            border-style: dashed;
            border-radius: 12px;
            border-color: #C7C7C7;
            display: table-cell;
            vertical-align: middle;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: rgba(0, 0, 0, 0.1) 0px -4px 16px 0px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px;
            flex-direction: column;
            gap: 20px;
        }

        .DisplayAddress {
            cursor: pointer;
            width: 21vw;
            background-color: #eff6ff;
            height: auto;
            border-radius: 12px;
            border-color: #C7C7C7;
            vertical-align: middle;
            align-items: center;
            box-shadow: rgba(0, 0, 0, 0.1) 0px -4px 16px 0px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        #addAddressbtn {
            border: none;
            background: none;
            color: inherit;
            padding: 0;
            font: inherit;
            cursor: pointer;
            outline: inherit;
        }

        #coupon-code-div {
            font-weight: 600;
            margin-top: 15px;
            margin-right: 10px;
            margin-left: 10px;
            font-size: larger;
        }

        .coupon-entry {
            width: 78%;
            height: 50px;
            float: right;
        }

        .actionbtn {
            border: none;
            border-radius: 5px;
            background-color: #2E51FF;
            color: white;
            margin-top: 11px;
        }

        .applycoupon {
            background: #2E51FF;
            float: right;
            position: relative;
            width: 140px;
            text-align: center;
            border-radius: 50px;
            margin-left: -50px;
        }
    </style>

    </head>

    <body>

        <%-include("./partials/nav-after-login.ejs")%>

            <div class="cart-products-container">
                <div class="cart-products-listing" style=" padding-top: 13px;">

                    <div class="selectAddresscontainer">
                        <div role="button" class="selectAddress">
                            <button id="addAddressbtn" data-toggle="modal" data-target="#exampleModal"><i
                                    class="fa-solid fa-plus" style="   font-size: 49px;"></i></button>
                            <h4>Add Address</h4>
                            <!-- add address modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <h4 style=" margin-left: 20px;  font-weight:600;">Add Address</h4>
                                            <form action="/adduserAddress" method="POST" style=" margin-top: 25px;"
                                                id="form">
                                                <div class="form-group  mb-4">
                                                    <input id="shippingName" type="text"
                                                        class="form-control entry shadow-none"
                                                        placeholder="Shipping name" name="shippingName">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;"
                                                        id="shippingNameError"></div>

                                                    <small class="form-text text-muted "></small>
                                                </div>
                                                <div class="form-group  mb-4">

                                                    <input id="phone" type="number"
                                                        class="form-control entry shadow-none"
                                                        placeholder="Phone Number" name="phone">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="phoneError">
                                                    </div>


                                                </div>
                                                <div class="form-group mt-4">
                                                    <input id="city" type="text" class="form-control entry shadow-none"
                                                        name="city" placeholder="City">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="cityError">
                                                    </div>
                                                </div>
                                                <div class="form-group mt-4">
                                                    <input id="state" type="text" class="form-control entry shadow-none"
                                                        name="state" placeholder="State">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="stateError">
                                                    </div>
                                                </div>
                                                <div class="form-group mt-4">
                                                    <input id="country" type="text"
                                                        class="form-control entry shadow-none" name="country"
                                                        placeholder="Country">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="countryError">
                                                    </div>
                                                </div>
                                                <div class="form-group mt-4">
                                                    <input id="pincode" type="number"
                                                        class="form-control entry shadow-none" name="pincode"
                                                        placeholder="Pincode">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="pincodeError">
                                                    </div>
                                                </div>



                                                <button type="submit " class="btn" value="submit"
                                                    style="margin-top: 48px;     margin-left: 64px ;"
                                                    id="signup-btn">Add Address</button>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>


                        </div>
                        <%userData.address.forEach((value)=>{%>
                            <div class="DisplayAddress">

                                <label style="font-weight: 600; margin-top: 10px;" class="form-check-label"
                                    for="<%=value._id%>">
                                    <%=value.shippingName%>
                                </label>

                                <div class="addressTexts" style="color: gray;">
                                    <span>Shipping Name : </span><span>
                                        <%=value.shippingName%>
                                    </span><br>
                                    <span>Phone No : </span><span>
                                        <%=value.phone%>
                                    </span><br>
                                    <span>City : </span><span>
                                        <%=value.city%>
                                    </span><br>
                                    <span>State : </span><span>
                                        <%=value.state%>
                                    </span><br>
                                    <span>Country : </span><span>
                                        <%=value.country%>
                                    </span><br>
                                    <span>Pincode : </span><span>
                                        <%=value.pincode%>
                                    </span>
                                </div>
                                <div>
                                    <!-- Updated "Edit" button in the loop -->
                                    <button class="actionbtn" data-toggle="modal"
                                        data-target="#editAddressModal<%= value._id %>"
                                        >Edit</button>

                                    <button data-toggle="modal" data-target="#DeleteAddressModal<%= value._id %>"
                                        class="actionbtn" type="submit">Delete</button>
                                    </form>

                                    <!-- are you sure modal -->
                                    <div class="modal fade" id="DeleteAddressModal<%= value._id %>" tabindex="-1"
                                        role="dialog" aria-labelledby="logoutModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="logoutModalLabel">
                                                    </h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">Are you sure you want to remove this Address?
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class=" btn-secondary " data-dismiss="modal"
                                                        style="border-radius: 7px;" aria-label="close">
                                                        Cancel
                                                    </button>

                                                    <a class="confirm-button btn-danger "
                                                        onclick="confirmDelete('<%= value._id %>')" data-dismiss="modal"
                                                        aria-label="close">Confirm</a>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- modal for edit address -->
                            <div class="modal fade" id="editAddressModal<%= value._id %>" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <!-- <h5 class="modal-title" id="exampleModalLabel">Modal title</h5> -->
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <h4 style=" margin-left: 20px;  font-weight:600;">Edit Address</h4>
                                            <form action="/edituserAddress?_id=<%=value._id%>" method="POST"
                                                style=" margin-top: 25px;" id="editform">
                                                <div class="form-group  mb-4">
                                                    <input id="shippingName" type="text" value="<%=value.shippingName%>"
                                                        class="form-control entry shadow-none"
                                                        placeholder="Shipping name" name="shippingName">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;"
                                                        id="shippingNameError"></div>
                                                    <small class="form-text text-muted "></small>
                                                </div>

                                                <div class="form-group  mb-4">
                                                    <input id="phone" type="number" value="<%=value.phone%>"
                                                        class="form-control entry shadow-none"
                                                        placeholder="Phone Number" name="phone">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="phoneError">
                                                    </div>
                                                </div>

                                                <div class="form-group mt-4">
                                                    <input id="city" type="text" value="<%=value.city%>"
                                                        class="form-control entry shadow-none" name="city"
                                                        placeholder="City">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="cityError">
                                                    </div>
                                                </div>

                                                <div class="form-group mt-4">
                                                    <input id="state" type="text" value="<%=value.state%>"
                                                        class="form-control entry shadow-none" name="state"
                                                        placeholder="State">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="stateError">
                                                    </div>
                                                </div>

                                                <div class="form-group mt-4">
                                                    <input id="country" type="text" value="<%=value.country%>"
                                                        class="form-control entry shadow-none" name="country"
                                                        placeholder="Country">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="countryError">
                                                    </div>
                                                </div>

                                                <div class="form-group mt-4">
                                                    <input id="pincode" type="number" value="<%=value.pincode%>"
                                                        class="form-control entry shadow-none" name="pincode"
                                                        placeholder="Pincode">
                                                    <div class="text-danger "
                                                        style="font-size: small; margin-left: 20px;" id="pincodeError">
                                                    </div>
                                                </div>




                                                <button type="submit " class="btn" value="submit"
                                                    style="margin-top: 48px;     margin-left: 64px ;"
                                                    id="signup-btn">Edit Address</button>
                                            </form>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <%})%>

                    </div>

                </div>

            </div>
            <script>
                function isEmpty(value) {
                    const trimmedValue = value.trim();
                    return trimmedValue === "";
                }

                //  validation for add address form
                document.querySelector("form").addEventListener("submit", function (event) {

                    const shippingNameInput = document.querySelector("#shippingName");
                    const shippingNameValue = shippingNameInput.value;
                    const shippingNameError = document.querySelector("#shippingNameError");


                    const phoneInput = document.querySelector("#phone");
                    const phoneValue = phoneInput.value;
                    const phoneError = document.querySelector("#phoneError");

                    const cityInput = document.querySelector("#city");
                    const cityValue = cityInput.value;
                    const cityError = document.querySelector("#cityError");

                    const stateInput = document.querySelector("#state");
                    const stateValue = stateInput.value;
                    const stateError = document.querySelector("#stateError");

                    const countryInput = document.querySelector("#country");
                    const countryValue = countryInput.value;
                    const countryError = document.querySelector("#countryError");

                    const pincodeInput = document.querySelector("#pincode");
                    const pincodeValue = pincodeInput.value;
                    const pincodeError = document.querySelector("#pincodeError");


                    shippingNameError.textContent = "";
                    phoneError.textContent = "";
                    cityError.textContent = "";
                    stateError.textContent = "";
                    countryError.textContent = "";
                    pincodeError.textContent = "";




                    if (isEmpty(shippingNameValue)) {
                        shippingNameError.textContent = "Shipping Name is required";
                        event.preventDefault();
                    }

                    if (isEmpty(phoneValue)) {
                        phoneError.textContent = "Phone number is required";
                        event.preventDefault();
                    }
                    if (isEmpty(cityValue)) {
                        cityError.textContent = "City name is required";
                        event.preventDefault();
                    }
                    if (isEmpty(stateValue)) {
                        stateError.textContent = "State name is required";
                        event.preventDefault();
                    }
                    if (isEmpty(countryValue)) {
                        countryError.textContent = "Country is required";
                        event.preventDefault();
                    }
                    if (isEmpty(pincodeValue)) {
                        pincodeError.textContent = "Pincode is required";
                        event.preventDefault();
                    }

                })

                //  validation for edit address form
                document.getElementById("editform").addEventListener("submit", function (event) {

                    alert("reached")
                    const shippingNameInput = document.querySelector("#shippingName");
                    const shippingNameValue = shippingNameInput.value;
                    const shippingNameError = document.querySelector("#shippingNameError");


                    const phoneInput = document.querySelector("#phone");
                    const phoneValue = phoneInput.value;
                    alert(phoneValue)
                    const phoneError = document.querySelector("#phoneError");

                    const cityInput = document.querySelector("#city");
                    const cityValue = cityInput.value;
                    const cityError = document.querySelector("#cityError");

                    const stateInput = document.querySelector("#state");
                    const stateValue = stateInput.value;
                    const stateError = document.querySelector("#stateError");

                    const countryInput = document.querySelector("#country");
                    const countryValue = countryInput.value;
                    const countryError = document.querySelector("#countryError");

                    const pincodeInput = document.querySelector("#pincode");
                    const pincodeValue = pincodeInput.value;
                    const pincodeError = document.querySelector("#pincodeError");



                    editShippingNameError.textContent = "";
                    phoneError.textContent = "";
                    cityError.textContent = "";
                    stateError.textContent = "";
                    countryError.textContent = "";
                    pincodeError.textContent = "";





                    if (isEmpty(editShippingNameInput)) {
                        editShippingNameError.textContent = "Shipping Name is required";
                        event.preventDefault();
                    }
                    if (isEmpty(phoneValue)) {
                        phoneError.textContent = "Phone number is required";
                        event.preventDefault();
                    }
                    if (isEmpty(cityValue)) {
                        cityError.textContent = "City name is required";
                        event.preventDefault();
                    }
                    if (isEmpty(stateValue)) {
                        stateError.textContent = "State name is required";
                        event.preventDefault();
                    }
                    if (isEmpty(countryValue)) {
                        countryError.textContent = "Country is required";
                        event.preventDefault();
                    }
                    if (isEmpty(pincodeValue)) {
                        pincodeError.textContent = "Pincode is required";
                        event.preventDefault();
                    }

                })
            </script>


            <script>
                function confirmDelete(addressId) {


                    fetch(`/deleteUserAddress/${addressId}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {

                            console.log(data);
                            if (data.success) {

                                window.location.reload()
                            }
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });
                }
            </script>



            <%-include("./partials/footer.ejs")%>
                <%-include("./partials/footerlinks.ejs")%>